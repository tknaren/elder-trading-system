<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elder Trading System v2</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0a0f1a; font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="bg-[#0a0f1a] text-gray-100 min-h-screen">
    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-56 bg-[#111827] border-r border-gray-700 min-h-screen fixed">
            <div class="p-4 border-b border-gray-700">
                <h1 class="font-bold text-lg flex items-center gap-2">üìà Elder Trading</h1>
                <p class="text-xs text-gray-500">Triple Screen v2.0</p>
            </div>
            <nav class="p-2" id="nav"></nav>
        </aside>

        <!-- Main -->
        <main class="ml-56 flex-1 min-h-screen">
            <header class="h-14 bg-[#111827] border-b border-gray-700 px-6 flex items-center justify-between sticky top-0 z-10">
                <div id="header-stats" class="flex gap-6 text-sm"></div>
                <select id="market" class="bg-[#1f2937] border border-gray-600 rounded px-3 py-1.5 text-sm">
                    <option value="US">üá∫üá∏ NASDAQ</option>
                    <option value="IN">üáÆüá≥ NSE</option>
                </select>
            </header>
            <div class="p-6" id="content"></div>
        </main>
    </div>

    <div id="toast" class="fixed bottom-4 right-4 z-50"></div>
    <div id="modal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-[#111827] rounded-xl border border-gray-700 max-w-4xl w-full max-h-[90vh] overflow-auto" id="modal-body"></div>
    </div>

    <script>
    const API = '/api';
    let currentTab = 'screener';
    let settings = [];
    let weeklyData = null;
    let checklist = {};

    const tabs = [
        {id:'screener', icon:'üîç', label:'Screener'},
        {id:'criteria', icon:'üìä', label:'Grading'},
        {id:'journal', icon:'üìñ', label:'Journal'},
        {id:'checklist', icon:'‚úÖ', label:'Checklist'},
        {id:'settings', icon:'‚öôÔ∏è', label:'Settings'}
    ];

    async function api(method, url, data) {
        const opts = {method, headers:{'Content-Type':'application/json'}};
        if(data) opts.body = JSON.stringify(data);
        return (await fetch(API+url, opts)).json();
    }

    function toast(msg, type='info') {
        const el = document.createElement('div');
        el.className = `px-4 py-2 rounded-lg mb-2 ${type==='success'?'bg-green-600':type==='error'?'bg-red-600':'bg-blue-600'}`;
        el.textContent = msg;
        document.getElementById('toast').appendChild(el);
        setTimeout(() => el.remove(), 3000);
    }

    function renderNav() {
        document.getElementById('nav').innerHTML = tabs.map(t => `
            <button onclick="switchTab('${t.id}')" class="w-full text-left px-3 py-2 rounded-lg mb-1 flex items-center gap-2 ${currentTab===t.id?'bg-blue-600/30 text-blue-400':'text-gray-400 hover:bg-gray-700/50'}">
                ${t.icon} ${t.label}
            </button>
        `).join('');
    }

    function renderHeader() {
        const s = settings[0] || {trading_capital:6000, risk_per_trade:2, currency:'GBP'};
        const sym = s.currency==='GBP'?'¬£':s.currency==='INR'?'‚Çπ':'$';
        document.getElementById('header-stats').innerHTML = `
            <div><span class="text-gray-500">Capital:</span> <span class="font-mono text-blue-400">${sym}${s.trading_capital?.toLocaleString()}</span></div>
            <div><span class="text-gray-500">Max Risk:</span> <span class="font-mono text-red-400">${sym}${(s.trading_capital*s.risk_per_trade/100).toFixed(0)}</span></div>
        `;
    }

    function switchTab(tab) { currentTab = tab; renderNav(); render(); }

    function render() {
        const c = document.getElementById('content');
        if(currentTab==='screener') c.innerHTML = screenView();
        else if(currentTab==='criteria') c.innerHTML = criteriaView();
        else if(currentTab==='journal') c.innerHTML = journalView();
        else if(currentTab==='checklist') c.innerHTML = checklistView();
        else if(currentTab==='settings') c.innerHTML = settingsView();
    }

    // ========== SCREENER ==========
    function screenView() {
        const results = weeklyData?.all_results || [];
        const sum = weeklyData?.summary || {};
        
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <div><h2 class="text-xl font-bold">Triple Screen Scanner</h2><p class="text-gray-500 text-sm">Weekly trend + Daily entry timing</p></div>
                    <div class="flex gap-2">
                        <button onclick="runWeekly()" class="px-4 py-2 bg-blue-600 rounded-lg font-medium hover:bg-blue-700">üîç Run Weekly Scan</button>
                        <button onclick="showCriteriaModal()" class="px-3 py-2 bg-gray-700 rounded-lg hover:bg-gray-600" title="How grading works">‚ùì</button>
                    </div>
                </div>

                ${weeklyData ? `
                    <div class="grid grid-cols-5 gap-3">
                        <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-3 text-center">
                            <div class="text-2xl font-bold text-green-400">‚≠ê${sum.a_trades||0}</div>
                            <div class="text-xs text-gray-400">A-Trades</div>
                        </div>
                        <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-center">
                            <div class="text-2xl font-bold text-blue-400">${sum.b_trades||0}</div>
                            <div class="text-xs text-gray-400">B-Trades</div>
                        </div>
                        <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 text-center">
                            <div class="text-2xl font-bold text-yellow-400">${sum.watch_list||0}</div>
                            <div class="text-xs text-gray-400">Watch</div>
                        </div>
                        <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-3 text-center">
                            <div class="text-2xl font-bold text-red-400">${sum.avoid||0}</div>
                            <div class="text-xs text-gray-400">Avoid</div>
                        </div>
                        <div class="bg-gray-700 rounded-lg p-3 text-center">
                            <div class="text-2xl font-bold">${results.length}</div>
                            <div class="text-xs text-gray-400">Total</div>
                        </div>
                    </div>

                    <div class="bg-[#111827] rounded-xl overflow-hidden border border-gray-700">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-[#1f2937]">
                                    <tr>
                                        <th class="text-left p-3 font-medium text-gray-400">Symbol</th>
                                        <th class="text-left p-3 font-medium text-gray-400">Price</th>
                                        <th class="text-left p-3 font-medium text-gray-400">Change</th>
                                        <th class="text-center p-3 font-medium text-gray-400">Grade</th>
                                        <th class="text-center p-3 font-medium text-gray-400">Score</th>
                                        <th class="text-left p-3 font-medium text-gray-400">Weekly</th>
                                        <th class="text-left p-3 font-medium text-gray-400">Impulse</th>
                                        <th class="text-right p-3 font-medium text-gray-400">Force Idx</th>
                                        <th class="text-right p-3 font-medium text-gray-400">Stoch</th>
                                        <th class="text-right p-3 font-medium text-gray-400">RSI</th>
                                        <th class="text-right p-3 font-medium text-gray-400">vs EMA</th>
                                        <th class="text-center p-3 font-medium text-gray-400">Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${results.map(r => `
                                        <tr class="border-t border-gray-700/50 hover:bg-[#1f2937]/50">
                                            <td class="p-3">
                                                <div class="font-mono font-bold">${r.symbol}</div>
                                                <div class="text-xs text-gray-500 truncate max-w-[100px]">${r.name||''}</div>
                                            </td>
                                            <td class="p-3 font-mono">$${r.price?.toFixed(2)}</td>
                                            <td class="p-3 font-mono ${r.change>=0?'text-green-400':'text-red-400'}">${r.change>=0?'+':''}${r.change?.toFixed(2)}</td>
                                            <td class="p-3 text-center">
                                                <span class="px-2 py-1 rounded text-xs font-bold ${
                                                    r.grade==='A'?'bg-green-500/20 text-green-400':
                                                    r.grade==='B'?'bg-blue-500/20 text-blue-400':
                                                    r.grade==='C'?'bg-yellow-500/20 text-yellow-400':
                                                    'bg-red-500/20 text-red-400'
                                                }">${r.is_a_trade?'‚≠ê':''} ${r.grade}</span>
                                            </td>
                                            <td class="p-3 text-center">
                                                <div class="flex items-center justify-center gap-1">
                                                    <div class="w-12 h-1.5 bg-gray-700 rounded overflow-hidden">
                                                        <div class="h-full ${r.signal_strength>=5?'bg-green-500':r.signal_strength>=3?'bg-yellow-500':'bg-red-500'}" style="width:${r.signal_strength*10}%"></div>
                                                    </div>
                                                    <span class="font-mono text-xs">${r.signal_strength}/10</span>
                                                </div>
                                            </td>
                                            <td class="p-3">
                                                <span class="${r.weekly_bullish?'text-green-400':'text-red-400'}">${r.weekly_ema_slope||'?'}</span>
                                                ${r.weekly_macd_rising?'<span class="text-green-400 ml-1">‚Üë</span>':'<span class="text-red-400 ml-1">‚Üì</span>'}
                                            </td>
                                            <td class="p-3">
                                                <span class="px-2 py-0.5 rounded text-xs font-bold ${
                                                    r.impulse_color==='GREEN'?'bg-green-500/20 text-green-400':
                                                    r.impulse_color==='RED'?'bg-red-500/20 text-red-400':
                                                    'bg-blue-500/20 text-blue-400'
                                                }">${r.impulse_color}</span>
                                            </td>
                                            <td class="p-3 text-right font-mono ${r.force_index<0?'text-green-400':'text-red-400'}">${(r.force_index/1e6)?.toFixed(1)}M</td>
                                            <td class="p-3 text-right font-mono ${r.stochastic<30?'text-green-400':r.stochastic>70?'text-red-400':'text-gray-300'}">${r.stochastic?.toFixed(0)}</td>
                                            <td class="p-3 text-right font-mono ${r.rsi<30?'text-green-400':r.rsi>70?'text-red-400':'text-gray-300'}">${r.rsi?.toFixed(0)}</td>
                                            <td class="p-3 text-right font-mono ${r.price_vs_ema<=0?'text-green-400':r.price_vs_ema>3?'text-red-400':'text-yellow-400'}">${r.price_vs_ema>=0?'+':''}${r.price_vs_ema?.toFixed(1)}%</td>
                                            <td class="p-3 text-center">
                                                <button onclick='showDetail(${JSON.stringify(r).replace(/'/g,"\\'")})'class="px-2 py-1 bg-gray-700 rounded text-xs hover:bg-blue-600">Details</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                ` : `
                    <div class="text-center py-20 text-gray-500">
                        <div class="text-6xl mb-4">üîç</div>
                        <h3 class="text-xl font-semibold">Run the scanner to see results</h3>
                        <p class="mt-2">All stocks will be displayed with their indicator values and grades</p>
                    </div>
                `}
            </div>
        `;
    }

    async function runWeekly() {
        toast('Scanning stocks...', 'info');
        const market = document.getElementById('market').value;
        try {
            weeklyData = await api('POST', '/screener/weekly', {market});
            toast(`Found ${weeklyData.summary?.a_trades||0} A-Trades!`, 'success');
            render();
        } catch(e) {
            toast('Scan failed: '+e.message, 'error');
        }
    }

    function showDetail(stock) {
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('modal-body').innerHTML = `
            <div class="p-6">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold">${stock.symbol}</h2>
                        <p class="text-gray-500">${stock.name}</p>
                    </div>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-lg mb-3 text-blue-400">üìä Current Values</h3>
                        <div class="space-y-2 bg-[#1f2937] rounded-lg p-4">
                            <div class="flex justify-between"><span class="text-gray-400">Price</span><span class="font-mono">$${stock.price?.toFixed(2)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">EMA 22</span><span class="font-mono">$${stock.ema_22?.toFixed(2)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">Price vs EMA</span><span class="font-mono ${stock.price_vs_ema<=0?'text-green-400':'text-red-400'}">${stock.price_vs_ema?.toFixed(1)}%</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">MACD Histogram</span><span class="font-mono">${stock.macd_histogram?.toFixed(4)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">Force Index</span><span class="font-mono ${stock.force_index<0?'text-green-400':'text-red-400'}">${stock.force_index?.toFixed(0)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">Stochastic</span><span class="font-mono">${stock.stochastic?.toFixed(1)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">RSI</span><span class="font-mono">${stock.rsi?.toFixed(1)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">ATR</span><span class="font-mono">$${stock.atr?.toFixed(2)}</span></div>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-lg mb-3 text-green-400">üìà Score Breakdown</h3>
                        <div class="space-y-2 bg-[#1f2937] rounded-lg p-4">
                            ${(stock.score_breakdown||[]).map(s => `
                                <div class="text-sm ${s.startsWith('+')?'text-green-400':s.startsWith('-')?'text-red-400':'text-gray-400'}">${s}</div>
                            `).join('')}
                            <div class="border-t border-gray-600 pt-2 mt-2">
                                <div class="flex justify-between font-bold">
                                    <span>Total Score</span>
                                    <span class="${stock.signal_strength>=5?'text-green-400':'text-yellow-400'}">${stock.signal_strength}/10</span>
                                </div>
                            </div>
                        </div>

                        <h3 class="font-bold text-lg mb-3 mt-6 text-yellow-400">üéØ Trade Levels</h3>
                        <div class="space-y-2 bg-[#1f2937] rounded-lg p-4">
                            <div class="flex justify-between"><span class="text-gray-400">Entry</span><span class="font-mono text-blue-400">$${stock.entry?.toFixed(2)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">Stop Loss</span><span class="font-mono text-red-400">$${stock.stop_loss?.toFixed(2)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">Target 1</span><span class="font-mono text-green-400">$${stock.target_1?.toFixed(2)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">Target 2</span><span class="font-mono text-green-400">$${stock.target_2?.toFixed(2)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-400">Risk</span><span class="font-mono">${stock.risk_percent?.toFixed(1)}%</span></div>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="font-bold text-lg mb-3">üí° Signals</h3>
                    <div class="flex flex-wrap gap-2">
                        ${(stock.signals||[]).map(s => `<span class="px-3 py-1 bg-[#1f2937] rounded-full text-sm">${s}</span>`).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    // ========== CRITERIA ==========
    function criteriaView() {
        return `
            <div class="space-y-6">
                <h2 class="text-xl font-bold">üìä Grading Criteria - Elder Triple Screen</h2>
                
                <div class="bg-[#111827] rounded-xl p-6 border border-gray-700">
                    <h3 class="font-bold text-lg text-blue-400 mb-4">Screen 1: Weekly Trend (Strategic Direction)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-[#1f2937] p-4 rounded-lg">
                            <p class="font-medium text-green-400">‚úì BULLISH (Look for longs)</p>
                            <ul class="text-sm text-gray-400 mt-2 space-y-1">
                                <li>‚Ä¢ 22-Week EMA Slope: Rising</li>
                                <li>‚Ä¢ Weekly MACD-H: Rising (bulls gaining)</li>
                            </ul>
                        </div>
                        <div class="bg-[#1f2937] p-4 rounded-lg">
                            <p class="font-medium text-red-400">‚úó BEARISH (Stay out)</p>
                            <ul class="text-sm text-gray-400 mt-2 space-y-1">
                                <li>‚Ä¢ 22-Week EMA Slope: Falling</li>
                                <li>‚Ä¢ Weekly MACD-H: Falling (bears in control)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="bg-[#111827] rounded-xl p-6 border border-gray-700">
                    <h3 class="font-bold text-lg text-green-400 mb-4">Screen 2: Daily Entry (Tactical Timing)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-[#1f2937] p-4 rounded-lg">
                            <p class="font-medium">Force Index (2-EMA)</p>
                            <p class="text-sm text-gray-400 mt-1"><span class="text-green-400">&lt; 0</span> = Pullback in uptrend = BUY ZONE</p>
                        </div>
                        <div class="bg-[#1f2937] p-4 rounded-lg">
                            <p class="font-medium">Stochastic</p>
                            <p class="text-sm text-gray-400 mt-1"><span class="text-green-400">&lt; 30</span> = Oversold = Good entry</p>
                        </div>
                        <div class="bg-[#1f2937] p-4 rounded-lg">
                            <p class="font-medium">Price vs 22-EMA</p>
                            <p class="text-sm text-gray-400 mt-1"><span class="text-green-400">At/Below</span> = Buying value</p>
                        </div>
                        <div class="bg-[#1f2937] p-4 rounded-lg">
                            <p class="font-medium">Impulse System</p>
                            <p class="text-sm text-gray-400 mt-1"><span class="text-green-400">GREEN</span> or <span class="text-blue-400">BLUE</span> = OK to buy</p>
                        </div>
                    </div>
                </div>

                <div class="bg-[#111827] rounded-xl p-6 border border-gray-700">
                    <h3 class="font-bold text-lg text-yellow-400 mb-4">Signal Strength Scoring (0-10)</h3>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div class="bg-green-500/10 p-2 rounded">+2: Weekly EMA strongly rising</div>
                        <div class="bg-green-500/10 p-2 rounded">+1: Weekly MACD-H rising</div>
                        <div class="bg-green-500/10 p-2 rounded">+2: Force Index &lt; 0 (pullback)</div>
                        <div class="bg-green-500/10 p-2 rounded">+2: Stochastic &lt; 30 (oversold)</div>
                        <div class="bg-green-500/10 p-2 rounded">+1: Stochastic 30-50</div>
                        <div class="bg-green-500/10 p-2 rounded">+1: Price at/below EMA</div>
                        <div class="bg-green-500/10 p-2 rounded">+2: Bullish divergence</div>
                        <div class="bg-green-500/10 p-2 rounded">+1: Impulse GREEN</div>
                        <div class="bg-red-500/10 p-2 rounded col-span-2">-2: Impulse RED (disqualifies trade)</div>
                    </div>
                </div>

                <div class="bg-[#111827] rounded-xl p-6 border border-gray-700">
                    <h3 class="font-bold text-lg mb-4">Grade Thresholds</h3>
                    <div class="grid grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-green-500/10 rounded-lg border border-green-500/30">
                            <div class="text-2xl">‚≠ê A</div>
                            <div class="text-sm text-gray-400 mt-2">Score ‚â• 5<br/>Impulse not RED</div>
                        </div>
                        <div class="text-center p-4 bg-blue-500/10 rounded-lg border border-blue-500/30">
                            <div class="text-2xl">üìä B</div>
                            <div class="text-sm text-gray-400 mt-2">Score 3-4<br/>Impulse GREEN/BLUE</div>
                        </div>
                        <div class="text-center p-4 bg-yellow-500/10 rounded-lg border border-yellow-500/30">
                            <div class="text-2xl">üëÄ C</div>
                            <div class="text-sm text-gray-400 mt-2">Score 1-2<br/>Watch list</div>
                        </div>
                        <div class="text-center p-4 bg-red-500/10 rounded-lg border border-red-500/30">
                            <div class="text-2xl">üõë AVOID</div>
                            <div class="text-sm text-gray-400 mt-2">Score ‚â§ 0<br/>OR Impulse RED</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function showCriteriaModal() { switchTab('criteria'); }

    // ========== JOURNAL ==========
    function journalView() {
        return `<div class="text-center py-20 text-gray-500">
            <div class="text-6xl mb-4">üìñ</div>
            <h3 class="text-xl">Trade Journal</h3>
            <p class="mt-2">Coming soon - record and track your trades</p>
        </div>`;
    }

    // ========== CHECKLIST ==========
    function checklistView() {
        const steps = [
            {id:'step1', title:'Check Positions & Orders', time:'5 min'},
            {id:'step2', title:'Weekly Chart Scan', time:'10 min'},
            {id:'step3', title:'Daily Chart Analysis', time:'15 min'},
            {id:'step4', title:'Calculate Entry/Stop/Target', time:'10 min'},
            {id:'step5', title:'Position Size', time:'5 min'},
            {id:'step6', title:'Place Orders', time:'5 min'},
            {id:'step7', title:'Update Trade Log', time:'5 min'}
        ];
        const done = Object.values(checklist).filter(Boolean).length;
        return `
            <div class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">‚úÖ Evening Checklist</h2>
                    <span class="text-sm text-gray-500">${done}/7 completed</span>
                </div>
                <div class="w-full h-2 bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-green-500 transition-all" style="width:${done/7*100}%"></div>
                </div>
                <div class="space-y-2">
                    ${steps.map(s => `
                        <div onclick="toggleCheck('${s.id}')" class="p-4 bg-[#111827] rounded-lg border ${checklist[s.id]?'border-green-500/50 opacity-60':'border-gray-700'} cursor-pointer hover:border-blue-500/50 flex items-center gap-4">
                            <div class="w-6 h-6 rounded-full border-2 ${checklist[s.id]?'bg-green-500 border-green-500':'border-gray-500'} flex items-center justify-center">
                                ${checklist[s.id]?'<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>':''}
                            </div>
                            <div class="flex-1">
                                <div class="font-medium">${s.title}</div>
                                <div class="text-xs text-gray-500">${s.time}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    async function toggleCheck(id) {
        checklist[id] = !checklist[id];
        await api('POST', '/checklist', {items:checklist});
        render();
    }

    // ========== SETTINGS ==========
    function settingsView() {
        const s = settings[0] || {account_name:'ISA', trading_capital:6000, risk_per_trade:2, max_monthly_drawdown:6, target_rr:2, currency:'GBP'};
        return `
            <div class="space-y-6 max-w-2xl">
                <h2 class="text-xl font-bold">‚öôÔ∏è Account Settings</h2>
                <div class="bg-[#111827] rounded-xl p-6 border border-gray-700 space-y-4">
                    <div><label class="text-sm text-gray-400">Account Name</label><input id="s-name" value="${s.account_name||''}" class="w-full mt-1 px-3 py-2 bg-[#1f2937] border border-gray-600 rounded-lg"></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="text-sm text-gray-400">Trading Capital</label><input type="number" id="s-capital" value="${s.trading_capital}" class="w-full mt-1 px-3 py-2 bg-[#1f2937] border border-gray-600 rounded-lg font-mono"></div>
                        <div><label class="text-sm text-gray-400">Currency</label><select id="s-currency" class="w-full mt-1 px-3 py-2 bg-[#1f2937] border border-gray-600 rounded-lg">
                            <option ${s.currency==='GBP'?'selected':''}>GBP</option>
                            <option ${s.currency==='USD'?'selected':''}>USD</option>
                            <option ${s.currency==='INR'?'selected':''}>INR</option>
                        </select></div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div><label class="text-sm text-gray-400">Risk % per Trade</label><input type="number" id="s-risk" value="${s.risk_per_trade}" step="0.5" class="w-full mt-1 px-3 py-2 bg-[#1f2937] border border-gray-600 rounded-lg font-mono"></div>
                        <div><label class="text-sm text-gray-400">Max Monthly DD %</label><input type="number" id="s-dd" value="${s.max_monthly_drawdown}" class="w-full mt-1 px-3 py-2 bg-[#1f2937] border border-gray-600 rounded-lg font-mono"></div>
                        <div><label class="text-sm text-gray-400">Target R:R</label><input type="number" id="s-rr" value="${s.target_rr}" step="0.5" class="w-full mt-1 px-3 py-2 bg-[#1f2937] border border-gray-600 rounded-lg font-mono"></div>
                    </div>
                    <button onclick="saveSettings()" class="w-full py-3 bg-blue-600 rounded-lg font-medium hover:bg-blue-700">üíæ Save Settings</button>
                </div>
            </div>
        `;
    }

    async function saveSettings() {
        const data = {
            account_name: document.getElementById('s-name').value,
            trading_capital: parseFloat(document.getElementById('s-capital').value),
            risk_per_trade: parseFloat(document.getElementById('s-risk').value),
            max_monthly_drawdown: parseFloat(document.getElementById('s-dd').value),
            target_rr: parseFloat(document.getElementById('s-rr').value),
            currency: document.getElementById('s-currency').value,
            market: document.getElementById('market').value
        };
        if(settings[0]?.id) await api('PUT', `/settings/${settings[0].id}`, data);
        else await api('POST', '/settings', data);
        settings = await api('GET', '/settings');
        renderHeader();
        toast('Settings saved!', 'success');
    }

    // ========== INIT ==========
    async function init() {
        settings = await api('GET', '/settings');
        const cl = await api('GET', '/checklist');
        checklist = cl.items || {};
        renderNav();
        renderHeader();
        render();
    }

    init();
    document.getElementById('modal').onclick = e => { if(e.target.id==='modal') closeModal(); };
    </script>
</body>
</html>
